<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Adventures with a Pygmy - Karl&#39;s Blog</title>
  <meta name="description" content="Featuring a pod of Pygmy Whales and a command line.">
  <meta name="author" content="Karl Hepworth"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Karl\x27s Blog",
    
    "url": "https:\/\/fubarhouse.github.io\/blog\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/fubarhouse.github.io\/blog\/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/fubarhouse.github.io\/blog\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/fubarhouse.github.io\/blog\/post\/2019-03-12\/",
          "name": "Adventures with a pygmy"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "Karl Hepworth"
  },
  "headline": "Adventures with a Pygmy",
  "description" : "Pygmy is the tool which helps the amazeeio-network Docker network resolve a few issues for local development, and I was never really happy with it\x26hellip; I suppose even though all of those problems are no longer an issue, but the history is now there.\nWhat I perceived to be a broken proxy was simply not suited to what I was doing - even though I wasn\x26rsquo;t doing anything unsuitable. Cloning a repository in two directories and running them with docker-compose seems like a tough ask for some\x26hellip;",
  "inLanguage" : "en",
  "wordCount":  705 ,
  "datePublished" : "2019-03-12T00:00:00",
  "dateModified" : "2019-03-12T00:00:00",
  "image" : "https:\/\/fubarhouse.github.io\/blog\/img\/avatar-icon.png",
  "keywords" : [ "pygmy, ruby, fun, docker" ],
  "mainEntityOfPage" : "https:\/\/fubarhouse.github.io\/blog\/post\/2019-03-12\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/fubarhouse.github.io\/blog\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/fubarhouse.github.io\/blog\/img\/avatar-icon.png",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="Adventures with a Pygmy" />
<meta property="og:description" content="Featuring a pod of Pygmy Whales and a command line.">
<meta property="og:image" content="https://fubarhouse.github.io/blog/img/avatar-icon.png" />
<meta property="og:url" content="https://fubarhouse.github.io/blog/post/2019-03-12/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Karl&#39;s Blog" />

  <meta name="twitter:title" content="Adventures with a Pygmy" />
  <meta name="twitter:description" content="Featuring a pod of Pygmy Whales and a command line.">
  <meta name="twitter:image" content="https://fubarhouse.github.io/blog/img/avatar-icon.png" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@fubarhouse" />
  <meta name="twitter:creator" content="@fubarhouse" />
  <link href='https://fubarhouse.github.io/blog/img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.66.0" />
  <link rel="alternate" href="https://fubarhouse.github.io/blog/index.xml" type="application/rss+xml" title="Karl&#39;s Blog"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://fubarhouse.github.io/blog/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://fubarhouse.github.io/blog/css/highlight.min.css" /><link rel="stylesheet" href="https://fubarhouse.github.io/blog/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">



  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://fubarhouse.github.io/blog/">Karl&#39;s Blog</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Blog" href="/blog/">Blog</a>
            </li>
          
        
          
            <li>
              <a title="About" href="/blog/page/about/">About</a>
            </li>
          
        
          
            <li>
              <a title="Tags" href="/blog/tags">Tags</a>
            </li>
          
        

        

        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="Karl&#39;s Blog" href="https://fubarhouse.github.io/blog/">
            <img class="avatar-img" src="https://fubarhouse.github.io/blog/img/avatar-icon.png" alt="Karl&#39;s Blog" />
          </a>
        </div>
      </div>
    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>Adventures with a Pygmy</h1>
              
              
              
                
                  <h2 class="post-subheading">Featuring a pod of Pygmy Whales and a command line.</h2>
                
              
              
                <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;
  
  
    &nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;4&nbsp;
  
  
  
    
      &nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;Karl Hepworth
    
  
  
</span>


              
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p>Pygmy is the tool which helps the <code>amazeeio-network</code> Docker network resolve a few issues for local development, and I was never really happy with it&hellip; I suppose even though all of those problems are no longer an issue, but the history is now there.</p>
<p>What I perceived to be a broken proxy was simply not suited to what I was doing - even though I wasn&rsquo;t doing anything unsuitable. Cloning a repository in two directories and running them with <code>docker-compose</code> seems like a tough ask for some&hellip;</p>
<p>So we have this exciting new stack, with some great example repositories. Running one appears to have an issue with the proxy config template, so I created my own Docker image and included a new config.</p>
<p>Cool, so it all works as I&rsquo;d expect with the changes I&rsquo;ve layered onto it. Still, I find myself bored with this little tool. It does some interesting things and it&rsquo;s very barebones - and it even depends on a static template. Looking into a better solution to the proxy I find myself trying out <a href="https://traefik.io/">Traefik</a>, and it does all I want and natively understands Docker because it&rsquo;s in Go, it communicates using the daemon and it supports Swarm, Kubernetes etc.</p>
<p>So after a few passes I get it working natively in a custom version of Pygmy. This time it&rsquo;s kinda hacked together with no real support or integration with the tool itself, but it&rsquo;s functional for my own needs.</p>
<p>Months later I&rsquo;m frustrated with my own work. Tired of manually changing ports in the Ruby files when I have new installations and tired of laborious installation processes. If I were to tell people about this and they tried it, I&rsquo;d frankly be surprised if anybody could get it started quickly.</p>
<p>So once more I&rsquo;ve revisited my fork of this tool and given it the proper attention it should deserve and I think I&rsquo;m finally happy. It all runs perfect as expected and by passing an optional flag you can choose to use Traefik instead of HAProxy. HAProxy will not at all run and Traefik will serve the purpose HAProxy serves in its place.</p>
<h2 id="features">Features</h2>
<ul>
<li>The Traefik microservice</li>
<li>A command-line flag to selectively specify Traefik should be used.</li>
<li>An added Traefik Docker label for Mailhog</li>
<li>Logic to start, stop and update, which supports the new Traefik flag to start and stop the right service.</li>
<li>Adds Traefik and resolver support to the pull and restart commands.</li>
<li>Some basic changes to support a gem release.</li>
</ul>
<h2 id="install">Install</h2>
<ul>
<li><code>pygmy</code> is not compatible directly with this special version, so you can run <code>gem uninstall pygmy</code> to remove pygmy.</li>
<li>Install the Gem by running <code>gem install pygmy-traefik</code>.</li>
</ul>
<h2 id="usage">Usage</h2>
<p>The usage really is vanilla, and this is the point of the deeper level of integration. The services and ports are logically allocated to avoid problems and to maintain compatibility and ease of use. So, just <a href="https://docs.amazee.io/local_docker_development/pygmy.html">follow official documentation</a>, but do consider the following changes to how it could be used:</p>
<ul>
<li><code>pygmy up --traefik</code>, <code>pygmy restart --traefik</code> and <code>pygmy pull --traefik</code> will ensure Traefik is used instead of HAProxy when the containers start.</li>
<li><code>pygmy status</code> will also include Traefik.</li>
<li>HAProxy will not run concurrently with Traefik.</li>
<li>Traefik&rsquo;s frontend can be access via <code>http://localhost:8080</code>.</li>
</ul>
<h2 id="why">Why</h2>
<p>This solves a couple of problems for me, and it&rsquo;s an elegant solution which anybody could utilise. I&rsquo;ve been using it for a while now and I plan on keeping it compatible with the upstream gem. This included partly a learning curve for myself as maintaining a Ruby repository is part of my plan. If I manage to get Prometheus and Grafana reasonably useful I may add them later - but the bare-bones prototype I have on top of this isn&rsquo;t really useful yet.</p>
<h2 id="moving-forward">Moving forward</h2>
<p>Well, creating tools has become a small speciality of mine so I would be interested in any feedback you could give me on this. I&rsquo;m also looking for opportunity to add microservices onto pygmy and potentially designing a plugin system to contribute upstream. Being able to have plugins would mean I could maintain this as a plugin instead of a separate fork of pygmy.</p>
<p>I&rsquo;m open to ideas and feedback so please reach out if you give it a go.</p>


        
          <div class="blog-tags">
            
              <a href="https://fubarhouse.github.io/blog//tags/pygmy/">pygmy</a>&nbsp;
            
              <a href="https://fubarhouse.github.io/blog//tags/ruby/">ruby</a>&nbsp;
            
              <a href="https://fubarhouse.github.io/blog//tags/fun/">fun</a>&nbsp;
            
              <a href="https://fubarhouse.github.io/blog//tags/docker/">docker</a>&nbsp;
            
          </div>
        

        

        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://fubarhouse.github.io/blog/post/2019-01-01/" data-toggle="tooltip" data-placement="top" title="Looking ahead into 2019">&larr; </a>
            </li>
          
          
            <li class="next">
              <a href="https://fubarhouse.github.io/blog/post/2019-05-28/" data-toggle="tooltip" data-placement="top" title="A delicious apple salad."> &rarr;</a>
            </li>
          
        </ul>
      


      

    </div>
  </div>
</div>

      
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              <a href="yourwebsite.com">Karl Hepworth</a>
            
          

          &nbsp;&bull;&nbsp;&copy;
          
            2020
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://fubarhouse.github.io/blog/">Karl&#39;s Blog</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          
          
        </p>
      </div>
    </div>
  </div>
</footer><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="https://fubarhouse.github.io/blog/js/main.js"></script>
<script src="https://fubarhouse.github.io/blog/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> $(document).ready(function() {$("pre.chroma").css("padding","0");}); </script><script> renderMathInElement(document.body); </script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://fubarhouse.github.io/blog/js/load-photoswipe.js"></script>









    
  </body>
</html>

